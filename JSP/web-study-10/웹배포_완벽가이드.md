# 🚀 JSP 프로젝트 웹 배포 완벽 가이드

## 📋 목차
1. [배포 개요](#1-배포-개요)
2. [데이터베이스 준비](#2-데이터베이스-준비)
3. [코드 설정 변경](#3-코드-설정-변경)
4. [빌드 및 배포](#4-빌드-및-배포)
5. [GitHub를 통한 배포](#5-github를-통한-배포)
6. [배포 후 테스트](#6-배포-후-테스트)
7. [문제 해결](#7-문제-해결)
8. [체크리스트](#8-체크리스트)

---

## 1. 배포 개요

### 현재 프로젝트 정보
- **프로젝트명**: web-study-10 (상품관리 시스템)
- **기술 스택**: JSP, Servlet, MySQL, Maven
- **로컬 DB 정보**:
  - 호스트: `localhost:3306`
  - 데이터베이스: `edudb`
  - 사용자: `jdbctest`
  - 비밀번호: `1234`

### 배포 전 알아야 할 것
1. **프로그램 코드 변경은 필요 없습니다** - 설정 파일만 수정하면 됩니다
2. 데이터베이스는 별도로 준비해야 합니다
3. 배포 방법은 여러 가지가 있습니다 (전통적 배포 / GitHub Actions)

---

## 2. 데이터베이스 준비

### 2-1. 로컬 DB에서 스키마 추출

#### 방법 1: MySQL Workbench 사용
```
1. MySQL Workbench 실행
2. Server → Data Export 메뉴 선택
3. edudb 데이터베이스 선택
4. Export to Self-Contained File 선택
5. Include Create Schema 체크
6. Start Export 클릭
```

#### 방법 2: 터미널 명령어
```bash
# 스키마만 추출 (테이블 구조만)
mysqldump -u jdbctest -p --no-data edudb > schema.sql

# 스키마 + 데이터 추출 (전체 백업)
mysqldump -u jdbctest -p edudb > full_backup.sql
```

### 2-2. 테이블 구조 확인

현재 프로젝트의 `product` 테이블 구조:
```sql
CREATE TABLE product (
    code INT AUTO_INCREMENT PRIMARY KEY COMMENT '상품 코드',
    name VARCHAR(100) NOT NULL COMMENT '상품명',
    price INT NOT NULL COMMENT '가격',
    pictureurl VARCHAR(50) COMMENT '이미지 파일명',
    description VARCHAR(1000) COMMENT '상품 설명'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**SQL 파일 위치**: `database/deploy.sql` 파일을 사용하세요.

### 2-3. 운영 DB 서버 준비

#### A. AWS RDS (추천 - 무료 티어 가능)
```
1. AWS 콘솔 로그인
2. RDS 서비스 선택
3. "데이터베이스 생성" 클릭
4. MySQL 선택
5. 템플릿: 프리티어 선택
6. 설정:
   - DB 인스턴스 식별자: edudb-prod
   - 마스터 사용자: admin
   - 마스터 암호: 강력한 비밀번호 설정
7. 퍼블릭 액세스: 예
8. 보안 그룹: 3306 포트 허용
9. 생성 완료 후 엔드포인트 주소 확인
   예: edudb-prod.xxxxx.ap-northeast-2.rds.amazonaws.com
```

#### B. Cafe24 호스팅 (국내)
```
1. Cafe24 호스팅 관리자 로그인
2. MySQL 관리 메뉴
3. 데이터베이스 생성
4. 제공된 DB 정보 확인:
   - 호스트: mysql123.cafe24.com
   - DB명: user_id
   - 사용자명: user_id
   - 비밀번호: 설정한 비밀번호
```

#### C. 가비아 호스팅 (국내)
```
1. 가비아 관리도구 로그인
2. MySQL 관리
3. DB 생성 및 정보 확인
```

#### D. 무료 호스팅 옵션
- **Railway** (초보자 친화적, 무료 티어)
- **Render** (무료 티어)
- **PlanetScale** (MySQL 호환, 무료 티어)

### 2-4. 운영 DB에 스키마 적용

#### 방법 1: MySQL Workbench
```
1. 운영 DB 연결 생성
2. File → Open SQL Script
3. database/deploy.sql 선택
4. 실행 (번개 아이콘)
```

#### 방법 2: 터미널
```bash
mysql -h [운영DB호스트] -u [사용자명] -p [DB명] < database/deploy.sql

# 예시 (AWS RDS)
mysql -h edudb-prod.xxxxx.ap-northeast-2.rds.amazonaws.com \
      -u admin -p edudb < database/deploy.sql
```

#### 방법 3: phpMyAdmin (호스팅 서비스)
```
1. 호스팅 제공 phpMyAdmin 접속
2. 데이터베이스 선택
3. "가져오기" 탭 클릭
4. database/deploy.sql 파일 선택
5. "실행" 클릭
```

---

## 3. 코드 설정 변경

### 3-1. 현재 상태 확인

현재 `DBManager.java`는 하드코딩된 DB 정보를 사용합니다:
```java
con = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/edudb?serverTimezone=Asia/Seoul", 
    "jdbctest",
    "1234"
);
```

**중요**: 코드를 변경할 필요는 없습니다! 설정 파일만 수정하면 됩니다.

### 3-2. 설정 파일 생성/수정

#### Step 1: db.properties 파일 확인
위치: `src/main/resources/db.properties`

#### Step 2: 운영 DB 정보로 수정
```properties
# 운영 환경 설정
db.url=jdbc:mysql://[운영DB호스트]:3306/edudb?serverTimezone=Asia/Seoul&useSSL=true
db.username=[운영DB사용자명]
db.password=[운영DB비밀번호]
db.driver=com.mysql.cj.jdbc.Driver

# 예시 (AWS RDS)
# db.url=jdbc:mysql://edudb-prod.xxxxx.ap-northeast-2.rds.amazonaws.com:3306/edudb?serverTimezone=Asia/Seoul&useSSL=true
# db.username=admin
# db.password=MyStr0ng!Password#2024
```

**주의**: `db.properties` 파일은 Git에 커밋하지 마세요! (`.gitignore`에 추가)

### 3-3. 환경변수 사용 (선택사항 - 더 안전)

운영 서버에서 환경변수로 DB 정보를 설정할 수 있습니다:

```bash
# Linux/Mac
export DB_URL="jdbc:mysql://운영DB주소:3306/edudb?serverTimezone=Asia/Seoul"
export DB_USERNAME="admin"
export DB_PASSWORD="운영DB비밀번호"

# Windows
set DB_URL=jdbc:mysql://운영DB주소:3306/edudb?serverTimezone=Asia/Seoul
set DB_USERNAME=admin
set DB_PASSWORD=운영DB비밀번호
```

---

## 4. 빌드 및 배포

### 4-1. Maven 빌드

```bash
# 1. 이전 빌드 정리
mvn clean

# 2. WAR 파일 빌드
mvn package -DskipTests

# 3. WAR 파일 확인
ls -lh target/*.war
```

### 4-2. 전통적인 배포 방법 (Tomcat 서버)

#### Step 1: Tomcat 서버 준비
- Tomcat 9 이상 설치
- Java 8 이상 설치 확인
- 포트 설정 (기본 8080)

#### Step 2: WAR 파일 배포
```bash
# 방법 1: webapps 폴더에 복사
cp target/web-study-10.war $TOMCAT_HOME/webapps/

# 방법 2: ROOT로 배포 (컨텍스트 경로 제거)
rm -rf $TOMCAT_HOME/webapps/ROOT
cp target/web-study-10.war $TOMCAT_HOME/webapps/ROOT.war
```

#### Step 3: Tomcat 시작
```bash
# 시작
$TOMCAT_HOME/bin/startup.sh   # Linux/Mac
$TOMCAT_HOME/bin/startup.bat  # Windows

# 또는 systemd 사용
sudo systemctl start tomcat

# 로그 확인
tail -f $TOMCAT_HOME/logs/catalina.out
```

---

## 5. GitHub를 통한 배포

### 5-1. GitHub Actions를 이용한 자동 배포

GitHub Actions를 사용하면 코드를 푸시할 때마다 자동으로 빌드하고 배포할 수 있습니다.

#### Step 1: GitHub Actions 워크플로우 파일 생성

`.github/workflows/deploy.yml` 파일 생성:

```yaml
name: Build and Deploy JSP Application

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        
    - name: Build with Maven
      run: mvn clean package -DskipTests
      
    - name: Upload WAR artifact
      uses: actions/upload-artifact@v3
      with:
        name: web-study-10
        path: target/*.war
        
    - name: Deploy to server
      uses: SamKirkland/FTP-Deploy-Action@4.3.0
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: ./target/
        server-dir: /webapps/
```

#### Step 2: GitHub Secrets 설정

GitHub 저장소 → Settings → Secrets and variables → Actions:

1. `FTP_SERVER`: FTP 서버 주소
2. `FTP_USERNAME`: FTP 사용자명
3. `FTP_PASSWORD`: FTP 비밀번호

#### Step 3: 코드 푸시

```bash
git add .
git commit -m "배포 설정 추가"
git push origin main
```

푸시하면 자동으로 빌드되고 배포됩니다!

### 5-2. Railway를 통한 배포 (무료, 쉬움)

Railway는 JSP 애플리케이션을 쉽게 배포할 수 있는 플랫폼입니다.

#### Step 1: Railway 계정 생성
1. [railway.app](https://railway.app) 접속
2. GitHub 계정으로 로그인

#### Step 2: 프로젝트 연결
1. "New Project" 클릭
2. "Deploy from GitHub repo" 선택
3. 저장소 선택

#### Step 3: 환경변수 설정
Railway 대시보드 → Variables 탭:
```
DB_URL=jdbc:mysql://[DB호스트]:3306/edudb?serverTimezone=Asia/Seoul
DB_USERNAME=[사용자명]
DB_PASSWORD=[비밀번호]
```

#### Step 4: 배포
자동으로 빌드되고 배포됩니다!

### 5-3. Render를 통한 배포

#### Step 1: Render 계정 생성
1. [render.com](https://render.com) 접속
2. GitHub 계정으로 로그인

#### Step 2: Web Service 생성
1. "New +" → "Web Service" 선택
2. GitHub 저장소 연결
3. 설정:
   - Build Command: `mvn clean package -DskipTests`
   - Start Command: `java -jar target/web-study-10.war`
   - Environment: Java

#### Step 3: 환경변수 설정
```
DB_URL=jdbc:mysql://[DB호스트]:3306/edudb
DB_USERNAME=[사용자명]
DB_PASSWORD=[비밀번호]
```

### 5-4. GitHub Pages (정적 파일만)

**주의**: GitHub Pages는 JSP를 실행할 수 없습니다. 정적 HTML/CSS/JS만 가능합니다.

JSP 애플리케이션은 서버가 필요하므로 GitHub Pages는 사용할 수 없습니다.

---

## 6. 배포 후 테스트

### 6-1. 기본 접속 테스트
- [ ] 웹 브라우저에서 접속
  ```
  http://서버IP:8080/web-study-10/
  또는
  http://도메인주소/
  ```
- [ ] 메인 페이지 정상 로드 확인
- [ ] 상품 목록 페이지 정상 표시 확인

### 6-2. 기능 테스트
- [ ] **상품 목록 조회** (`productList.do`)
  - DB 연결 정상 확인
  - 데이터 정상 표시 확인
  - 이미지 정상 표시 확인
- [ ] **상품 등록** (`productWrite.do`)
  - 등록 폼 정상 표시
  - 이미지 업로드 정상 동작
  - DB에 데이터 저장 확인
- [ ] **상품 수정** (`productUpdate.do`)
  - 기존 데이터 불러오기
  - 수정 후 저장
  - DB 업데이트 확인
- [ ] **상품 삭제** (`productDelete.do`)
  - 삭제 확인 메시지
  - DB에서 삭제 확인

### 6-3. 브라우저 호환성 테스트
- [ ] Chrome 테스트
- [ ] Firefox 테스트
- [ ] Safari 테스트
- [ ] 모바일 브라우저 테스트

---

## 7. 문제 해결

### 문제 1: DB 연결 실패
**에러**: `Communications link failure`

**해결방법**:
1. 방화벽에서 3306 포트 허용 확인
2. DB 호스트 주소 확인
3. 사용자명/비밀번호 확인
4. MySQL 서버 실행 상태 확인
5. `db.properties` 파일 확인

```bash
# DB 연결 테스트
mysql -h [호스트] -u [사용자] -p

# 방화벽 확인
telnet [DB호스트] 3306
```

### 문제 2: 한글 깨짐
**해결방법**:
1. DB 문자셋 확인
   ```sql
   SHOW VARIABLES LIKE 'character%';
   ALTER DATABASE edudb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```
2. Tomcat `server.xml` 확인
   ```xml
   <Connector URIEncoding="UTF-8" />
   ```
3. JSP 페이지 인코딩 확인
   ```jsp
   <%@ page contentType="text/html; charset=UTF-8" %>
   ```

### 문제 3: 404 Not Found
**해결방법**:
1. WAR 파일이 정상 배포되었는지 확인
2. Tomcat 로그 확인
   ```bash
   tail -f $TOMCAT_HOME/logs/catalina.out
   ```
3. 컨텍스트 경로 확인
4. `web.xml` 설정 확인

### 문제 4: 이미지 업로드 실패
**해결방법**:
1. `upload/` 디렉토리 권한 확인
   ```bash
   chmod 755 upload/
   ```
2. 디스크 공간 확인
   ```bash
   df -h
   ```
3. 업로드 크기 제한 확인 (`web.xml`)

### 문제 5: GitHub Actions 배포 실패
**해결방법**:
1. GitHub Actions 로그 확인
2. Secrets 설정 확인
3. FTP 서버 접속 확인
4. 빌드 로그 확인

---

## 8. 체크리스트

### 📋 배포 전 체크리스트

#### ✅ 데이터베이스 준비
- [ ] 운영 DB 서버 준비 완료
- [ ] 로컬 DB 백업 완료
  ```bash
  mysqldump -u jdbctest -p edudb > backup_$(date +%Y%m%d).sql
  ```
- [ ] 운영 DB에 스키마 적용
  ```bash
  mysql -h [운영DB호스트] -u [사용자] -p [DB명] < database/deploy.sql
  ```
- [ ] 운영 DB 접속 테스트 완료

#### ✅ 코드 설정
- [ ] `db.properties` 파일 생성/수정
  - 위치: `src/main/resources/db.properties`
  - 운영 DB 정보로 업데이트
- [ ] `.gitignore`에 `db.properties` 추가
- [ ] 하드코딩된 경로 확인 (이미지 업로드 경로 등)

#### ✅ 보안 설정
- [ ] DB 비밀번호 강화 (8자 이상, 특수문자 포함)
- [ ] DB 사용자 권한 최소화
  ```sql
  GRANT SELECT, INSERT, UPDATE, DELETE ON edudb.* TO 'app_user'@'%';
  ```
- [ ] SSL/TLS 연결 설정 (가능시)

#### ✅ 빌드 및 배포
- [ ] Maven 빌드 성공
  ```bash
  mvn clean package -DskipTests
  ```
- [ ] WAR 파일 생성 확인
- [ ] 서버에 배포 완료
- [ ] Tomcat 재시작 (필요시)

#### ✅ 배포 후 테스트
- [ ] 웹 애플리케이션 정상 구동 확인
- [ ] DB 연결 정상 확인
- [ ] 모든 CRUD 기능 테스트
- [ ] 이미지 업로드/표시 정상
- [ ] 한글 처리 정상
- [ ] 에러 로그 확인

---

## 9. 배포 방법 비교

| 방법 | 난이도 | 비용 | 추천도 | 설명 |
|------|--------|------|--------|------|
| **전통적 배포** | 중 | 서버 비용 | ⭐⭐⭐ | 직접 서버 관리 필요 |
| **Railway** | 쉬움 | 무료/유료 | ⭐⭐⭐⭐⭐ | 가장 쉬움, GitHub 연동 |
| **Render** | 쉬움 | 무료/유료 | ⭐⭐⭐⭐ | 무료 티어 제공 |
| **AWS RDS + EC2** | 어려움 | 유료 | ⭐⭐⭐ | 확장성 좋음 |
| **GitHub Actions** | 중 | 서버 비용 | ⭐⭐⭐⭐ | 자동화 가능 |

---

## 10. 실전 예제: Railway 배포

### Step 1: Railway 계정 생성
1. [railway.app](https://railway.app) 접속
2. GitHub 계정으로 로그인

### Step 2: 프로젝트 연결
1. "New Project" 클릭
2. "Deploy from GitHub repo" 선택
3. `web-study-10` 저장소 선택

### Step 3: MySQL 데이터베이스 추가
1. "New" → "Database" → "MySQL" 선택
2. 데이터베이스 생성 완료
3. "Variables" 탭에서 연결 정보 확인

### Step 4: 환경변수 설정
Railway 대시보드 → Variables 탭:
```
DB_URL=jdbc:mysql://[Railway가 제공한 DB 호스트]:3306/railway
DB_USERNAME=root
DB_PASSWORD=[Railway가 제공한 비밀번호]
```

### Step 5: 배포 확인
1. "Deployments" 탭에서 배포 상태 확인
2. 배포 완료 후 제공된 URL로 접속 테스트

---

## 📚 추가 자료

### 관련 문서
- [MySQL 공식 문서](https://dev.mysql.com/doc/)
- [Apache Tomcat 문서](https://tomcat.apache.org/tomcat-9.0-doc/)
- [Railway 문서](https://docs.railway.app/)
- [Render 문서](https://render.com/docs)

### 유용한 도구
- **MySQL Workbench**: DB 관리 GUI 도구
- **DBeaver**: 무료 범용 DB 도구
- **phpMyAdmin**: 웹 기반 DB 관리

---

## ✅ 최종 점검

배포 전 마지막으로 확인하세요:

1. ✅ **DB 백업**: 로컬 DB 완전 백업
2. ✅ **운영 DB**: 스키마와 데이터 정상 적용
3. ✅ **설정 파일**: `db.properties` 운영 DB 정보로 수정
4. ✅ **보안**: 강력한 비밀번호, 최소 권한
5. ✅ **테스트**: 로컬에서 운영 DB 연결 테스트
6. ✅ **빌드**: WAR 파일 정상 생성
7. ✅ **배포**: 서버에 정상 배포
8. ✅ **기능 테스트**: 모든 기능 정상 동작 확인

---

**배포 성공을 기원합니다! 🎉**

문제가 발생하면:
1. 로그 확인
2. 체크리스트 재검토
3. 이 가이드의 문제 해결 섹션 참조
4. 커뮤니티/포럼 검색

