# 🎓 JSP 로그인 시스템 완전 정복 가이드 (초보자용)

## 📚 목차
1. [시스템 전체 구조 이해하기](#1-시스템-전체-구조-이해하기)
2. [각 파일의 역할 (비유로 이해하기)](#2-각-파일의-역할-비유로-이해하기)
3. [로그인 프로세스 상세 설명](#3-로그인-프로세스-상세-설명)
4. [코드 한 줄씩 이해하기](#4-코드-한-줄씩-이해하기)
5. [문제 해결 과정 정리](#5-문제-해결-과정-정리)

---

## 1. 시스템 전체 구조 이해하기

### 🏗️ 전체 그림 (비유: 식당 주문 시스템)

```
[고객] → [웨이터] → [주방장] → [냉장고(DB)]
  ↓         ↓          ↓            ↓
브라우저  Servlet   DAO        Oracle DB
```

**비유 설명:**
- **고객(브라우저)**: 로그인을 원하는 사용자
- **웨이터(Servlet)**: 주문을 받고 결과를 전달하는 중간 역할
- **주방장(DAO)**: 실제로 냉장고(DB)에서 재료를 찾아오는 역할
- **냉장고(DB)**: 회원 정보가 저장된 곳

### 📁 파일 구조

```
web-study-09/
├── src/main/
│   ├── java/com/saeyan/
│   │   ├── controller/
│   │   │   └── LoginServlet.java    ← 웨이터 (요청 처리)
│   │   └── dto/
│   │       ├── MemberDAO.java       ← 주방장 (DB 작업)
│   │       └── MemberVO.java        ← 그릇 (데이터 담는 용기)
│   └── webapp/
│       ├── member/
│       │   └── login.jsp            ← 메뉴판 (로그인 화면)
│       └── WEB-INF/
│           └── web.xml              ← 식당 규칙서
```

---

## 2. 각 파일의 역할 (비유로 이해하기)

### 📄 1. login.jsp - "메뉴판" (로그인 화면)

**역할**: 사용자가 보는 화면

**비유**: 식당의 메뉴판처럼, 사용자가 아이디와 비밀번호를 입력할 수 있는 화면을 보여줍니다.

**주요 구성 요소:**

```jsp
<form name="frm" action="<%=request.getContextPath()%>/login.do" method="post">
```

- **`<form>`**: 사용자가 입력한 정보를 담는 상자
- **`name="frm"`**: 상자에 이름을 붙임 (JavaScript에서 찾기 위해)
- **`action="/login.do"`**: 이 상자를 어디로 보낼지 지정 (웨이터에게 전달)
- **`method="post"`**: 비밀번호 같은 중요한 정보는 POST 방식으로 전송

**JavaScript 검증 (loginCheck 함수):**

```javascript
function loginCheck() {
    if(document.frm.userid.value == "") {
        alert("아이디를 입력해주세요.");
        return false;  // 폼 제출을 막음
    }
    // ...
}
```

**비유**: 주문하기 전에 "메뉴를 선택하셨나요?" 확인하는 것과 같습니다.

---

### ☕ 2. LoginServlet.java - "웨이터" (요청 처리)

**역할**: 사용자의 요청을 받아서 처리하고 결과를 전달

**비유**: 
- 고객이 주문하면 웨이터가 주문을 받고
- 주방장에게 전달하고
- 완성된 음식을 고객에게 가져다주는 역할

**두 가지 역할:**

#### ① GET 요청 처리 (doGet) - "메뉴판 보여주기"

```java
protected void doGet(...) {
    request.getRequestDispatcher("member/login.jsp")
        .forward(request, response);
}
```

**비유**: 고객이 "메뉴판 보여주세요"라고 하면 메뉴판(login.jsp)을 가져다주는 것

#### ② POST 요청 처리 (doPost) - "주문 처리하기"

```java
protected void doPost(...) {
    // 1. 주문서(폼 데이터) 받기
    String userid = request.getParameter("userid");
    String pwd = request.getParameter("pwd");
    
    // 2. 주방장(DAO)에게 확인 요청
    MemberDAO dao = MemberDAO.getInstance();
    int result = dao.userCheck(userid, pwd);
    
    // 3. 결과에 따라 처리
    if(result == 1) {
        // 성공: 환영 페이지 보여주기
    } else {
        // 실패: 다시 로그인 페이지로
    }
}
```

**비유**: 
- 고객이 주문하면 주문서를 받고
- 주방장에게 "이 메뉴 있나요?" 확인하고
- 있으면 음식 가져다주고, 없으면 "없습니다"라고 말하는 것

---

### 🍳 3. MemberDAO.java - "주방장" (DB 작업)

**역할**: 데이터베이스와 직접 소통하는 전문가

**비유**: 냉장고(DB)를 열어서 재료(회원 정보)를 찾아오는 주방장

**주요 메서드:**

#### ① getConnection() - "냉장고 열기"

```java
public Connection getConnection() {
    Class.forName("oracle.jdbc.driver.OracleDriver");  // 열쇠 준비
    con = DriverManager.getConnection(...);            // 냉장고 열기
    return con;
}
```

**비유**: 냉장고를 여는 열쇠를 준비하고 냉장고를 여는 과정

#### ② userCheck() - "재료 확인하기"

```java
public int userCheck(String userid, String pwd) {
    // 1. 냉장고 열기
    con = getConnection();
    
    // 2. SQL 쿼리 준비: "이 아이디의 비밀번호 찾기"
    String sql = "select pwd from member where userid = ?";
    
    // 3. 쿼리 실행
    rs = pstmt.executeQuery();
    
    // 4. 결과 확인
    if(rs.next()) {
        if(비밀번호가 맞으면) return 1;  // 성공
        else return 0;                    // 비밀번호 틀림
    } else {
        return 0;  // 아이디 없음
    }
}
```

**비유**: 
- 냉장고에서 "사과"를 찾아서
- 가져온 사과가 신선한지 확인하는 것

**반환값:**
- `1`: 로그인 성공 ✅
- `0`: 아이디 없음 또는 비밀번호 틀림 ❌
- `-1`: DB 연결 오류 ⚠️

---

### 🥣 4. MemberVO.java - "그릇" (데이터 담는 용기)

**역할**: 회원 정보를 담는 그릇

**비유**: 음식을 담는 그릇처럼, 회원 정보를 담는 용기

```java
public class MemberVO {
    private String name;      // 이름
    private String userid;   // 아이디
    private String pwd;      // 비밀번호
    private String email;    // 이메일
    private String phone;    // 전화번호
    private int admin;       // 권한
}
```

**비유**: 그릇에 여러 칸이 있어서 각각 다른 음식을 담는 것처럼, 회원 정보의 각 항목을 담습니다.

---

## 3. 로그인 프로세스 상세 설명

### 🔄 전체 흐름도 (단계별)

```
[1단계] 사용자가 브라우저에서 /login.do 접속
   ↓
[2단계] LoginServlet의 doGet() 실행
   ↓
[3단계] login.jsp 화면 표시 (로그인 폼)
   ↓
[4단계] 사용자가 아이디/비밀번호 입력 후 "로그인" 버튼 클릭
   ↓
[5단계] JavaScript 검증 (loginCheck 함수)
   ├─ 아이디 비어있음 → "아이디를 입력해주세요" 팝업
   ├─ 비밀번호 비어있음 → "비밀번호를 입력해주세요" 팝업
   └─ 모두 입력됨 → 다음 단계로 진행
   ↓
[6단계] 폼 데이터가 LoginServlet의 doPost()로 전송
   ↓
[7단계] LoginServlet이 아이디/비밀번호 받기
   ↓
[8단계] MemberDAO.userCheck() 호출
   ↓
[9단계] MemberDAO가 DB에서 확인
   ├─ DB 연결 (getConnection)
   ├─ SQL 쿼리 실행 ("select pwd from member where userid = ?")
   └─ 결과 확인
   ↓
[10단계] 결과 반환
   ├─ result = 1 → 로그인 성공
   ├─ result = 0 → 로그인 실패
   └─ result = -1 → DB 오류
   ↓
[11단계] LoginServlet이 결과에 따라 처리
   ├─ 성공: 세션에 아이디 저장 + 성공 페이지 표시
   └─ 실패: 로그인 페이지로 돌아가서 에러 메시지 표시
```

---

### 📝 각 단계 상세 설명

#### 1단계: 사용자가 브라우저에서 접속

```
사용자: http://localhost:8080/web-study-09/login.do
```

**비유**: 식당에 들어와서 "메뉴판 주세요"라고 말하는 것

---

#### 2-3단계: 로그인 화면 표시

```java
// LoginServlet.java의 doGet()
request.getRequestDispatcher("member/login.jsp")
    .forward(request, response);
```

**비유**: 웨이터가 메뉴판을 가져다주는 것

**결과**: 사용자 화면에 로그인 폼이 표시됨

---

#### 4-5단계: 사용자 입력 및 JavaScript 검증

```javascript
// login.jsp의 JavaScript
function loginCheck() {
    if(document.frm.userid.value == "") {
        alert("아이디를 입력해주세요.");
        return false;  // 폼 제출 중단
    }
    if(document.frm.pwd.value == "") {
        alert("비밀번호를 입력해주세요.");
        return false;  // 폼 제출 중단
    }
    return true;  // 폼 제출 허용
}
```

**비유**: 주문하기 전에 "메뉴 선택하셨나요?" 확인하는 것

**동작:**
- 아이디가 비어있으면 → 팝업 표시 → 폼 제출 안 함
- 비밀번호가 비어있으면 → 팝업 표시 → 폼 제출 안 함
- 모두 입력되었으면 → 폼 제출 진행

---

#### 6-7단계: 데이터 전송 및 받기

```java
// LoginServlet.java의 doPost()
String userid = request.getParameter("userid");
String pwd = request.getParameter("pwd");
```

**비유**: 웨이터가 주문서를 받는 것

**동작:**
- 폼에서 입력한 `userid`와 `pwd` 값을 받아옴
- `request.getParameter()`는 HTML 폼의 `name` 속성으로 값을 찾음

---

#### 8-9단계: DB에서 확인

```java
// LoginServlet.java
MemberDAO dao = MemberDAO.getInstance();
int result = dao.userCheck(userid, pwd);

// MemberDAO.java
public int userCheck(String userid, String pwd) {
    // 1. DB 연결
    con = getConnection();
    
    // 2. SQL 쿼리 준비
    String sql = "select pwd from member where userid = ?";
    pstmt = con.prepareStatement(sql);
    pstmt.setString(1, userid);  // ?에 userid 넣기
    
    // 3. 쿼리 실행
    rs = pstmt.executeQuery();
    
    // 4. 결과 확인
    if(rs.next()) {  // 결과가 있으면
        if(rs.getString("pwd").equals(pwd)) {
            return 1;  // 비밀번호 맞음 → 성공
        } else {
            return 0;  // 비밀번호 틀림 → 실패
        }
    } else {
        return 0;  // 아이디 없음 → 실패
    }
}
```

**비유**: 
- 웨이터가 주방장에게 "이 메뉴 있나요?" 물어보고
- 주방장이 냉장고를 열어서 확인하는 것

**SQL 쿼리 설명:**
```sql
select pwd from member where userid = ?
```
- `member` 테이블에서
- `userid`가 입력한 값과 같은 행을 찾아서
- 그 행의 `pwd`(비밀번호)를 가져옴

**PreparedStatement의 `?` 사용:**
- `?`는 나중에 값을 넣을 자리
- `pstmt.setString(1, userid)`로 첫 번째 `?`에 `userid` 값을 넣음
- **왜 사용하나요?** SQL 인젝션 공격을 방지하기 위해!

---

#### 10-11단계: 결과 처리

```java
if(result == 1) {
    // 로그인 성공
    HttpSession session = request.getSession();
    session.setAttribute("userid", userid);  // 세션에 아이디 저장
    
    // 성공 페이지 HTML 직접 출력
    response.setContentType("text/html; charset=UTF-8");
    response.getWriter().println("<h1>🎉 로그인 성공!</h1>");
    // ...
} else if(result == 0) {
    // 로그인 실패
    request.setAttribute("message", "아이디 또는 비밀번호가 맞지 않습니다.");
    request.getRequestDispatcher("member/login.jsp").forward(request, response);
}
```

**비유**: 
- 성공: "주문하신 음식 나왔습니다!" 하면서 음식 가져다주기
- 실패: "죄송합니다. 그 메뉴는 없습니다" 하면서 다시 메뉴판 보여주기

**세션(Session)이란?**
- 로그인한 사용자를 기억하기 위한 저장소
- 서버에 일정 시간 동안 저장됨
- 다른 페이지에서도 "이 사람이 로그인했구나" 알 수 있음

**비유**: 식당에서 "이 고객은 VIP입니다"라고 표시해두는 것과 같음

---

## 4. 코드 한 줄씩 이해하기

### 🔍 login.jsp 핵심 코드

#### 1. 폼 태그

```jsp
<form name="frm" action="<%=request.getContextPath()%>/login.do" method="post">
```

**분해 설명:**
- `<form>`: 입력 폼 시작
- `name="frm"`: 폼에 이름 붙이기 (JavaScript에서 `document.frm`으로 접근)
- `action="..."`: 이 폼을 어디로 보낼지
  - `<%=request.getContextPath()%>`: 프로젝트 경로 (예: `/web-study-09`)
  - `/login.do`: LoginServlet으로 보내기
- `method="post"`: POST 방식으로 전송 (비밀번호 같은 중요한 정보)

---

#### 2. JavaScript 검증

```javascript
onclick="return loginCheck();"
```

**분해 설명:**
- `onclick`: 버튼 클릭 시 실행할 JavaScript 코드
- `return loginCheck()`: 
  - `loginCheck()` 함수 실행
  - 함수가 `false`를 반환하면 → 폼 제출 중단
  - 함수가 `true`를 반환하면 → 폼 제출 진행

**왜 `return`이 필요한가요?**
- `return false`를 하면 폼 제출이 취소됨
- `return true`를 하면 폼 제출이 진행됨

---

### 🔍 LoginServlet.java 핵심 코드

#### 1. @WebServlet 어노테이션

```java
@WebServlet("/login.do")
```

**분해 설명:**
- `@WebServlet`: "이 클래스는 서블릿입니다"라고 서버에 알려주는 것
- `"/login.do"`: "이 URL로 요청이 오면 이 서블릿을 실행하세요"

**비유**: 식당 입구에 "웨이터 여기 있습니다"라고 표시하는 것

---

#### 2. request.getParameter()

```java
String userid = request.getParameter("userid");
```

**분해 설명:**
- `request`: 사용자가 보낸 요청 정보가 담긴 상자
- `getParameter("userid")`: 그 상자에서 `name="userid"`인 값을 꺼내기
- HTML의 `<input name="userid">`에서 입력한 값이 여기로 옴

**비유**: 주문서 상자에서 "아이디" 항목을 찾아서 읽는 것

---

#### 3. 세션 사용

```java
HttpSession session = request.getSession();
session.setAttribute("userid", userid);
```

**분해 설명:**
- `request.getSession()`: 세션 가져오기 (없으면 새로 만들기)
- `session.setAttribute("userid", userid)`: 세션에 "userid"라는 이름으로 값 저장

**비유**: 
- 고객에게 "VIP 카드"를 주고
- 그 카드에 "이 사람의 아이디는 test입니다"라고 적어두는 것

**다른 페이지에서 사용:**
```jsp
<%
    String userid = (String)session.getAttribute("userid");
    if(userid != null) {
        out.println("안녕하세요 " + userid + "님!");
    }
%>
```

---

### 🔍 MemberDAO.java 핵심 코드

#### 1. 싱글톤 패턴

```java
private static MemberDAO instance = new MemberDAO();

public static MemberDAO getInstance() {
    return instance;
}
```

**분해 설명:**
- `private static MemberDAO instance`: 클래스 전체에서 하나만 존재하는 객체
- `private MemberDAO()`: 외부에서 직접 생성 못하게 막기
- `getInstance()`: 유일한 객체를 반환

**왜 싱글톤을 사용하나요?**
- 객체를 여러 개 만들 필요가 없음
- 메모리 절약
- DB 연결도 효율적

**비유**: 주방장은 한 명만 있으면 되니까, 여러 명 고용할 필요 없음

---

#### 2. PreparedStatement 사용

```java
String sql = "select pwd from member where userid = ?";
pstmt = con.prepareStatement(sql);
pstmt.setString(1, userid);
rs = pstmt.executeQuery();
```

**분해 설명:**
- `?`: 나중에 값을 넣을 자리 (플레이스홀더)
- `prepareStatement(sql)`: SQL 문을 미리 준비
- `setString(1, userid)`: 첫 번째 `?`에 `userid` 값 넣기
- `executeQuery()`: 쿼리 실행

**왜 `?`를 사용하나요?**
- SQL 인젝션 공격 방지
- 사용자가 악의적인 SQL 코드를 입력해도 실행되지 않음

**예시:**
```java
// 나쁜 예 (위험!)
String sql = "select * from member where userid = '" + userid + "'";
// 만약 userid가 "admin' OR '1'='1"이면?
// → "select * from member where userid = 'admin' OR '1'='1'"
// → 모든 회원 정보가 조회됨! (보안 위험!)

// 좋은 예 (안전!)
String sql = "select * from member where userid = ?";
pstmt.setString(1, userid);
// → 악의적인 코드가 있어도 그냥 문자열로 처리됨
```

---

## 5. 문제 해결 과정 정리

### 🐛 발생했던 문제들과 해결 방법

#### 문제 1: JavaScript 팝업이 안 나옴

**원인:**
1. 폼에 `name="frm"` 속성이 없어서 JavaScript가 폼을 찾지 못함
2. JavaScript 파일 경로 문제

**해결:**
```jsp
<!-- 수정 전 -->
<form action="login.do" method="post">

<!-- 수정 후 -->
<form name="frm" action="<%=request.getContextPath()%>/login.do" method="post">
```

**이유:** JavaScript에서 `document.frm`으로 폼을 찾기 위해 `name` 속성이 필요함

---

#### 문제 2: POST 요청이 404 에러

**원인:**
- `login.jsp`가 `/member/login.jsp` 경로에 있어서
- 상대 경로 `action="login.do"`가 `/member/login.do`로 해석됨
- 하지만 LoginServlet은 `/login.do`에만 매핑되어 있음

**해결:**
```jsp
<!-- 수정 전 -->
<form action="login.do" method="post">

<!-- 수정 후 -->
<form action="<%=request.getContextPath()%>/login.do" method="post">
```

**이유:** 절대 경로를 사용하여 항상 올바른 경로로 요청 보내기

---

#### 문제 3: main.jsp로 forward 실패 (404 에러)

**원인:**
- `main.jsp` 파일이 서버의 배포 디렉토리에 없음
- forward가 실패하여 404 에러 발생

**해결:**
```java
// forward 대신 직접 HTML 출력
response.setContentType("text/html; charset=UTF-8");
response.getWriter().println("<!DOCTYPE html>");
response.getWriter().println("<html>");
// ... HTML 코드 직접 출력
```

**이유:** 외부 파일에 의존하지 않고 서블릿에서 직접 HTML을 생성하여 출력

---

## 📚 핵심 개념 정리

### 1. MVC 패턴 (Model-View-Controller)

```
Model (데이터)     → MemberDAO, MemberVO
View (화면)        → login.jsp
Controller (제어) → LoginServlet
```

**비유:**
- **Model**: 냉장고(데이터 저장소)
- **View**: 메뉴판(사용자가 보는 화면)
- **Controller**: 웨이터(중간에서 조율)

---

### 2. GET vs POST

**GET:**
- URL에 데이터가 노출됨
- 예: `http://example.com?userid=test&pwd=1234`
- 브라우저 주소창에 보임
- **용도**: 정보 조회 (로그인 페이지 보기)

**POST:**
- 데이터가 요청 본문에 숨겨져 있음
- URL에 노출되지 않음
- **용도**: 정보 전송 (로그인 처리)

**비유:**
- **GET**: "메뉴판 보여주세요" (정보만 요청)
- **POST**: "이 음식 주문합니다" (정보를 전송)

---

### 3. 세션(Session) vs 쿠키(Cookie)

**세션:**
- 서버에 저장됨
- 보안에 유리함
- 용량 제한 없음
- **용도**: 로그인 정보, 장바구니 등

**쿠키:**
- 브라우저에 저장됨
- 보안에 불리함
- 용량 제한 있음 (4KB)
- **용도**: 자동 로그인, 언어 설정 등

**비유:**
- **세션**: 식당의 VIP 카드 (식당이 보관)
- **쿠키**: 고객이 가져가는 스탬프 카드 (고객이 보관)

---

## 🎯 실전 팁

### 1. 디버깅 방법

**서버 콘솔 확인:**
```java
System.out.println("로그인 시도: 아이디=" + userid);
```

**브라우저 개발자 도구:**
- F12 키 누르기
- Network 탭에서 요청/응답 확인
- Console 탭에서 JavaScript 오류 확인

---

### 2. 보안 주의사항

✅ **해야 할 것:**
- PreparedStatement 사용 (SQL 인젝션 방지)
- POST 방식 사용 (비밀번호 전송)
- 세션 사용 (로그인 상태 관리)

❌ **하지 말아야 할 것:**
- Statement 사용 (SQL 인젝션 위험)
- GET 방식으로 비밀번호 전송
- 비밀번호를 평문으로 저장

---

### 3. 코드 작성 순서

1. **화면 만들기** (login.jsp)
2. **데이터베이스 연결** (MemberDAO)
3. **요청 처리** (LoginServlet)
4. **테스트 및 디버깅**

---

## 🎓 마무리

이제 로그인 시스템의 전체 흐름을 이해하셨을 것입니다!

**핵심 요약:**
1. 사용자가 로그인 화면에서 정보 입력
2. JavaScript로 기본 검증
3. Servlet이 요청 받아서 처리
4. DAO가 DB에서 확인
5. 결과에 따라 성공/실패 페이지 표시

**다음 단계:**
- 회원가입 기능 추가
- 로그아웃 기능 구현
- 세션 관리 개선
- 비밀번호 암호화

화이팅! 💪
