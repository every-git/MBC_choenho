<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.mapper.AccountMapper">
	
	<insert id="insert">
		insert into tbl_account (uid, upw, uname, email)
		values (#{uid}, #{upw}, #{uname}, #{email})
	</insert>
	
	<insert id="insertRoles">
		insert into tbl_account_roles (uid, role)
		values 
		<foreach collection="roleNames" item="role" separator=",">
			(#{uid}, #{role})
		</foreach>
	</insert>

	<resultMap type="org.zerock.dto.AccountDTO" id="selectMap" autoMapping="true">
		<id property="uid" column="uid"/>
		<result property="upw" column="upw"/>
		<result property="uname" column="uname"/>
		<result property="email" column="email"/>
		<collection property="roleNames" ofType="java.lang.String" javaType="java.util.ArrayList">
			<result column="role"/>
		</collection>
	</resultMap>

	<select id="selectOne" resultMap="selectMap">
		select a.uid, a.upw, a.uname, a.email, r.role
		from tbl_account a
		left join tbl_account_roles r
		on a.uid = r.uid
		where a.uid = #{uid}
	</select>
	
</mapper>
